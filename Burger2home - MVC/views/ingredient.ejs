<%- include('header.ejs') %>

<h2>Liste des ingredients</h2> 
<div class="table-responsive">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Nom</th>
        <th>Allergenes</th>
      </tr>
    </thead>
    <tbody id="myTable">
      <% for(var i = 0; i < data.length; i++) { %>
      <tr>
        <form class="contact-form" action="/update_ingredient/<%= data[i].id_ingredient %>" method="post">
        <td><input type="number" value="<%= data[i].id_ingredient %>" style="width: 3em;" name="id_ingredient" disabled></td>
        <td><input type ="texte" value="<%= data[i].nom_ingredient %>" name="nom_ingredient" style="width: 14em;"></td>
        
        <td>
          <fieldset class="checkbox-list">
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="1"  id="<%= data[i].id_ingredient %>.1">Gluten</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="2" id="<%= data[i].id_ingredient %>.2">Crustacé</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="3" id="<%= data[i].id_ingredient %>.3">Oeuf</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="4" id="<%= data[i].id_ingredient %>.4">Poisson</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="5" id="<%= data[i].id_ingredient %>.5">Arachide</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="6" id="<%= data[i].id_ingredient %>.6">Soja</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="7" id="<%= data[i].id_ingredient %>.7">Lait</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="8" id="<%= data[i].id_ingredient %>.8">Fruit à coque</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="9" id="<%= data[i].id_ingredient %>.9">Céleri</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="10" id="<%= data[i].id_ingredient %>.10">Moutarde</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="11" id="<%= data[i].id_ingredient %>.11">Graines de sésame</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="12" id="<%= data[i].id_ingredient %>.12">Sulfite</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="13" id="<%= data[i].id_ingredient %>.13">Lupin</label>
            </div>
            <div class="checkbox">
              <label><input type="checkbox" name="nom_allergenes" value="14" id="<%= data[i].id_ingredient %>.14">Mollusque</label>
            </div>
          </fieldset>        
        </td>
        <td><button type="submit"><i class="fas fa-edit"></i></button></td>
        </form>
        <td>
        <button><a href="/delete_ingredient/<%= data[i].id_ingredient %>" style="color: black; text-decoration: none"><i class="fas fa-trash"></i></a></button>                 
        </td>
      </tr>
      <% } %>
    </tbody>
  </table>
</div>
<button class="btn-create"><a href="/create_ingredient" style="color: black; text-decoration: none"><i class="fas fa-plus-circle"></i> Créer ingrédient</a></button>


  <script>
   let datas = '<%- JSON.stringify(data) %>';
   let datasArr = JSON.parse(datas);
   let datas2 = '<%- JSON.stringify(data2) %>';
   datas2Arr = JSON.parse(datas2);

   datasArr.forEach(data => {
     datas2Arr.forEach(data2 => {
       for (let i = 0; i<13; i++) {
        if (data.id_ingredient === data2.id_ingredient && data2.id_allergene === (i+1)) {
          document.getElementById(`${data2.id_ingredient}.${i+1}`).checked = true;   
        }
       }
     });
   });
  </script>

  <%- include('footer.ejs') %>